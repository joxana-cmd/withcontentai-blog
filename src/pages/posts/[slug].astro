---
import Base from '../../layouts/Base.astro';
import { getCollection, getEntryBySlug } from 'astro:content';

export async function getStaticPaths() {
  const posts = await getCollection('posts');
  return posts.map((post) => ({ params: { slug: post.slug } }));
}

const { slug } = Astro.params;
const post = await getEntryBySlug('posts', slug);
if (!post) throw new Error(`Post not found: ${slug}`);

const rendered = await post.render();
const Content = rendered.Content;
const data = rendered.data ?? {};
---
<Base title={data?.title ?? "Untitled"}>
  <a href="/">← Back</a>
  <h1>{data?.title ?? "Untitled"}</h1>
  {data?.pubDate && <p class="post-meta">{new Date(data.pubDate).toDateString()}</p>}
  <Content />
</Base>
